<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - Ciacollor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen">
    <header class="bg-slate-900 text-white p-4 sticky top-0 z-50 shadow-md">
        <div class="container mx-auto flex flex-col md:row justify-between items-center gap-4">
            <h1 class="font-bold text-xl uppercase tracking-tighter text-yellow-500">Admin Ciacollor</h1>
            <input type="text" id="searchInput" placeholder="Buscar producto..." class="p-2 rounded bg-slate-800 text-white w-full md:w-64 border border-slate-700">
        </div>
    </header>

    <main class="container mx-auto p-6">
        <div id="productGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <p class="text-center col-span-full">Cargando base de datos...</p>
        </div>
    </main>

    <script>
        let productData = JSON.parse(localStorage.getItem('ciacollor_db')) || {};
        let rawProducts = [];

        // FunciÃ³n para cargar el archivo JSON real que subiste a GitHub
        async function loadData() {
            try {
                const response = await fetch('data.json');
                rawProducts = await response.json();
                render();
            } catch (e) {
                document.getElementById('productGrid').innerHTML = "Error cargando data.json";
            }
        }

        function render(search = '') {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = '';

            rawProducts.forEach(product => {
                if(!product.nombre.toLowerCase().includes(search.toLowerCase())) return;

                product.variantes.forEach(variant => {
                    const sku = variant.sku_id;
                    const info = productData[sku] || { price: '0.00', stock: true };
                    
                    const card = document.createElement('div');
                    card.className = `bg-white p-4 rounded-xl shadow-sm border-2 ${info.stock ? 'border-transparent' : 'border-red-200 opacity-60'}`;
                    card.innerHTML = `
                        <p class="text-[10px] font-bold text-gray-400">ID: ${sku}</p>
                        <h2 class="font-bold text-sm mb-2 h-10 overflow-hidden">${product.nombre}</h2>
                        <p class="text-blue-600 font-bold text-xs mb-4">${variant.medida}</p>
                        
                        <label class="block text-[10px] uppercase font-bold text-gray-500">Precio</label>
                        <input type="number" value="${info.price}" onblur="save(${sku}, 'price', this.value)" 
                               class="w-full p-2 bg-gray-100 rounded mb-4 font-bold">

                        <div class="flex justify-between items-center bg-gray-50 p-2 rounded">
                            <span class="text-xs font-bold">${info.stock ? 'DISPONIBLE' : 'SIN STOCK'}</span>
                            <input type="checkbox" ${info.stock ? 'checked' : ''} onchange="save(${sku}, 'stock', this.checked)">
                        </div>
                    `;
                    grid.appendChild(card);
                });
            });
        }

        function save(sku, field, value) {
            if(!productData[sku]) productData[sku] = { price: '0.00', stock: true };
            productData[sku][field] = field === 'price' ? value : value;
            localStorage.setItem('ciacollor_db', JSON.stringify(productData));
            if(field === 'stock') render(document.getElementById('searchInput').value);
        }

        document.getElementById('searchInput').addEventListener('input', (e) => render(e.target.value));
        loadData();
    </script>
</body>
</html>
